<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
  <head>
    <title>Diagnosticar y ajustar</title>
    <meta charset="utf-8" />
    <meta name="author" content="Máster Análisis Político y Electoral (UC3M)" />
    <link href="libs/font-awesome/css/fontawesome-all.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="xaringan-themer.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: left, middle, inverse, title-slide

# Diagnosticar y ajustar
## Representatividad y ajustes en encuestas con <i class="fab  fa-r-project "></i>
### Máster Análisis Político y Electoral (UC3M)
### Pablo Cabrera Álvarez (USAL) <br> <span style="font-size: 50%;"><a href="mailto:pablocal@usal.es" class="email">pablocal@usal.es</a> | <a href="https://github.com/pablocal"><i class="fab  fa-github "></i></a> | <a href="https://twitter.com/pablocalv"><i class="fab  fa-twitter "></i></a> <span class="citation">@pablocalv</span> </span> <br>
### Nov. 2019

---




class: inverse, center, middle

# Tenemos un problema

---
# Reino Unido, 2015

![](pics/gif1.gif)

---
# La clave estaba en la representatividad
&lt;center&gt;
![Sturgis et al., 2016](pics/pic3.png)
&lt;/center&gt;
Sturgis *et al.*, 2016
---
# Diagnosticar y ajustar

- Encuestas, muestreo y otros problemas

- Encuestas electorales y muestreo

- Análisis de representatividad

  - **Práctica**: análisis de representatividad

- Ajustes en las encuestas

- Generar un peso paso a paso con `R`

  - **Práctica**: ponderar una muestra


---
class: inverse, center, middle

# Encuestas, muestreo y otros problemas

---
background-image: url(pics/pic1.png)
background-position: 60% 70% 
background-size: 60% 
# Doble inferencia

Font y Pasadas, 2016  
---
# Muestreo e inferencia

&lt;img src="presentacion_files/figure-html/unnamed-chunk-1-1.png" style="display: block; margin: auto;" /&gt;

---
# Muestreo e inferencia

&lt;img src="presentacion_files/figure-html/unnamed-chunk-2-1.png" style="display: block; margin: auto;" /&gt;

---
# Varianza y sesgo

.pull-left[
![](presentacion_files/figure-html/unnamed-chunk-3-1.png)&lt;!-- --&gt;
]

--

.pull-right[
![](presentacion_files/figure-html/unnamed-chunk-4-1.png)&lt;!-- --&gt;
]

---
# Muestreo ideal (probabilístico)

- Existe un **marco muestral** en el que están listados *todos* los elementos de la población.

--

- El marco muestral contiene **información auxiliar** como sexo, edad o ingresos. Estas variables son útiles para estratificar la muestra.

--

- Todos los elementos seleccionados en la muestra **responden** a la encuesta.

--

- **Procedimiento**: todos los casos tienen una probabilidad `\(\frac{n}{N}\)` de ser elegidos. Se seleccionan `\(n\)` casos a partir de números aleatorios.

--

&lt;table&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt; Nombre &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; Sexo &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Edad &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; Población &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Teléfono &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Fernández Fernández, Antonio &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; H &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 25 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Madrid &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 666534 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Pérez Pérez, Clara &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; M &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 26 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Madrid &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 6663245 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; González González, María &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; M &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 47 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Fuenlabrada &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 9234534 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

---
# Muestreo real

.pull-left[
¿Existe en España un **marco muestral** de la población general al que tengan acceso las organizaciones dedicadas a la investigación social?
]

---
# Muestreo real

.pull-left[
¿Existe en España un **marco muestral** de la población general al que tengan acceso las organizaciones dedicadas a la investigación social?


  - Existen registros como el **padrón de población** (INE), pero las empresas de investigación sólo pueden acceder a los datos anonimizados.
]

---
# Muestreo real

.pull-left[
¿Existe en España un **marco muestral** de la población general al que tengan acceso las organizaciones dedicadas a la investigación social?


  - Existen registros como el **padrón de población** (INE), pero las empresas de investigación sólo pueden acceder a los datos anonimizados.

¿Todos los elementos de la muestra **responden** a la encuesta?
]


---
# Muestreo real

.pull-left[
¿Existe en España un **marco muestral** de la población general al que tengan acceso las organizaciones dedicadas a la investigación social?


  - Existen registros como el **padrón de población** (INE), pero las empresas de investigación sólo pueden acceder a los datos anonimizados.

¿Todos los elementos de la muestra **responden** a la encuesta?


  - No, las tasas de respuestas en encuestas telefónicas pueden llegar a estar **por debajo del 10%** (Kennedy y Hartig, 2019).
]
  
--
.pull-right[
&lt;a href="https://www.pewresearch.org/fact-tank/2019/02/27/response-rates-in-telephone-surveys-have-resumed-their-decline/ft_19-02-27_atp1_afterbriefplateau_2/"&gt;&lt;img src="https://www.pewresearch.org/wp-content/uploads/2019/02/FT_19.02.27_ATP1_Afterbriefplateau_2.png?w=350"&gt;&lt;/a&gt;
]
---
# Los problemas del muestreo probabilístico

Problemas de las **encuestas probabilísticas**:

--

- Impedimentos **técnicos**. No existe marco muestral, está incompleto o no es posible acceder. Posible sesgo provocado por la no respuesta.



- Mayor **coste** que un muestreo no probabilístico. Necesidad de extender el trabajo de campo en encuestas telefónicas y personales.



- Necesita más **tiempo** para recoger los datos. Los hogares que no responden necesitan ser contactados en diferentes horarios por un período de tiempo suficiente.

---
# Alternativas

- **Muestreo probabilístico combinado con no probabilístico**. Una parte de la selección de las unidades muestrales se realiza utilizando procedimientos probabilísticos. En el último paso se utilizan cuotas para elegir a la persona entrevistada.

  - **Muestro de hogares** se realiza a partir de rutas aleatorias o de número de teléfono (fijos y móviles) generados de forma aleatoria (RDD).

  - Las **cuotas** se establecen a partir de los datos poblacionales. Se utilizan variables como sexo y edad. Cada zona geográfica tiene asignadas unas cuotas. Al finalizar el trabajo de campo el perfil de sexo y edad de la muestra coincidirá con el de la población.

--

- **Muestreo no probabilístico**. No se conoce la probabilidad de selección de los elementos de la población (Baker *et al.*, 2013).

  - Encuestas por **cuotas o *river sampling***. Paneles de internautas reclutados a partir de captación activa o pasiva.

  - **Inferir a partir de muestras no probabilísticas**. Procedimientos estadísticos o ajustes para mejorar la representatividad de la muestra e inferir.

---
# Problemas asociados a las muestras no probabilísticas

- Encuesta a partir de un **panel online** de volunatios para conocer **intención de voto** de la población general.
    
--

  - Sesgo de **cobertura**. Algunos elementos de la población no tienen ninguna posibilidad de ser elegidos. Por ejemplo, una parte importante de las personas mayores de 65 años no acceden con regularidad a internet. Este problema también puede afectar a las muestras  probabilísticas.

--

  - Sesgo de **autoselección**. La entrada en el panel está determinada por los propios usuarios, que deciden unirse, en ocasiones porque reciben una compensación econónmica a cambio de cada encuesta completada.  

--
  
  - Sesgo de **no respuesta**. Todos los panelistas invitados no completarán la encuesta. Esto puede ser un problema si aquellos que contestan son diferentes que los que no responden. Este problema también afecta a las muestras probabilísticas.

---
# Problemas asociados a las muestras no probabilísticas

&lt;img src="pics/pic5.png" width="555" style="display: block; margin: auto;" /&gt;

Elliot y Valliant, 2017

---
class: inverse, center, middle
# Muestreo en encuestas electorales

---
# Muestreo en encuestas electorales
Las encuestas se pueden diferenciar según el modo de muestreo elegido.

- Las encuestas realizadas para el análisis político y electoral suelen partir de **muestras probabilísticas/no probabilísticas o no probabilísticas**. Se ha demostrado que algunas muestras no probabilísticas han sido más precisas al estimar el resultado electoral (Baker *et al.*, 2013).

--

- En España las encuesta **telefónicas utilizan cuotas de sexo y edad**. Desde hace unos años algunas empresas han dejado el sistema de cuotas. Algunas encuestas de panel online utilizan **cuotas más exhaustivas**.

--

- En algunas encuestas telefónicas se especifica el **uso de teléfonos fijos y móviles**. En otros casos no se conoce.

--

- El muestreo suele estar **estratificado por comunidad y tamaño de hábitat**. En algunas encuestas telefónicas se utiliza el municipio como punto muestral.

---
# Encuestas electorales en España

&lt;table&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt; Organización &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; Muestreo &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; Descripción &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; CIS (Barómetros) &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Prob./No prob. &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Presencial. Selección de secciones censales de forma probabilística. Hogares con rutas aleatorias. Entrevistados por cuotas sexo y edad. &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; CIS (ESE) &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Probabilístico &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Presencial. Selección de personas directamente del padrón. &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Metroscopia &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Prob./No prob. &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Telefónica (móviles). Muestra aleatoria de teléfonos. Sin cuotas. &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; GAD3 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Prob./No prob. &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Telefónica (fijos y móviles). Cuotas sexo, edad y región. &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
---
# Encuestas electorales en España

&lt;table&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt; Organización &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; Muestreo &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; Descripción &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; IMOP insights &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Prob./No prob. &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Telefónica (fijos 55% y móviles 45%). Muestra aleatoria de teléfonos sin cuotas. &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; 40dB &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Prob./No prob. &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Panel de internautas. Cuotas de sexo, edad, clase social, región y tamaño de hábitat. &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; GESOP &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Prob./No prob. &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Telefónica. Cuotas de sexo y edad. &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; NC Rport &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Prob./No prob. &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Telefónica. Cuotas de sexo y edad. &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Sociométrica &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Prob./No prob. &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Telefónica y panel de internautas. Cuotas sexo, edad y provincia. &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
---
class: inverse, center, middle
# Análisis de representatividad

---
# La información de la ficha técnica

Estudiar **ficha técnica** de la encuesta:

- **Modo** de administración `\(\rightarrow\)` Problemas de cobertura o respuesta.

  - Encuesta **telefónica**: móviles o fijos, generación aleatoria de números.
  - Encuesta **panel de internautas**: tipo de captación.  

--
  
- Detalles del **muestreo** `\(\rightarrow\)` Tipo de muestreo (variables que han tenido en cuenta en el diseño).
  
--
  
- **Fechas** del trabajo de campo `\(\rightarrow\)` Procedimientos de campo (llamadas o visitas). 

--

- **Tamaño** de la muestra y margen de error `\(\rightarrow\)` Precisión de las estimaciones (probabilística o cuasiprobabilística).

---
# Análisis de representatividad por pasos

**Comparar la distribución poblacional** de ciertas varaibles con la **muestra**:

1. **Identificar las variables** del cuestionario que son susceptibles de tener equivalentes poblacionales.
  
--

2. Encontrar la fuentes de **datos poblacionales**:
  - Registros poblacionales (INE).
  - Encuestas con altos estándares metodológicos (ESE, CIS).

--

3. Determinar la **equivalencia de los datos poblacionales**. Tener en cuenta posibles errores de medición y comparabilidad de las variables (*p. ej.* estudios).

--

4. Calcular la **diferencia** entre las distribuciones de los datos poblaciones y las variables de la encuesta.

--

5. Calcular el **error absoluto medio** (*MAE*) de cada variable. En la que `\(\hat{y}\)` es el porcentaje de la categoría en la encuesta e `\(y\)` el porcentaje en la población. `\(k\)` es el número de categorías de la variable.


`$$\begin{aligned}
MAE = \frac{\sum{|\hat{y} - y|}}{k}
\end{aligned}$$`


---
# Cálculo del MAE

&lt;table&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt; Variable &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; Categoría &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Muestra &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Población &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Dif. &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Grupo de edad &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 18-29 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 22 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 18 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 4 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Grupo de edad &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 30-44 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 25 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 24 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Grupo de edad &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 45-64 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 23 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 23 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Grupo de edad &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 65+ &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 30 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 35 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 5 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

`$$\begin{aligned}
MAE = \frac{10}{4} = 2.5
\end{aligned}$$`


---

class: inverse, center, middle
# Práctica: análisis de representatividad

---

class: inverse, center, middle
# Ajustes en las encuestas

---
# Una muestra de usuarios de Xbox

.pull-left[
- En el marco de las elecciones presidenciales de 2012 en EE.UU Wang *et al.* realizaron una **encuesta (no probabilística)** a través de la plataforma de **usuarios de la Xbox**. La encuesta tuvo 345000 respuestas.
]

---
# Una muestra de usuarios de Xbox

.pull-left[
- En el marco de las elecciones presidenciales de 2012 en EE.UU Wang *et al.* realizaron una **encuesta (no probabilística)** a través de la plataforma de **usuarios de la Xbox**. La encuesta tuvo 345000 respuestas.

- El nivel de **desajuste era notable**: 65% de los encuestados entre 18-29 años (19% en la población). Los hombres representaban el 93% (47% en la población). Mitt Romney sobrerrepresentado.
]

---
# Una muestra de usuarios de Xbox

.pull-left[
- En el marco de las elecciones presidenciales de 2012 en EE.UU Wang *et al.* realizaron una **encuesta (no probabilística)** a través de la plataforma de **usuarios de la Xbox**. La encuesta tuvo 345000 respuestas.

- El nivel de **desajuste era notable**: 65% de los encuestados entre 18-29 años (19% en la población). Los hombres representaban el 93% (47% en la población). Mitt Romney sobrerrepresentado.

- Ajustaron la muestra utilizando **técnicas estadísticas**. El resultado fue similar al del promedio de encuestas tradicionales.
]

--

.pull-right[
&lt;img src="pics/pic4.png" width="386" style="display: block; margin: auto;" /&gt;
Wang *et al.*, 2015
]

---
# Pesos o ponderaciones

- Son **ajustes estadísticos** para preservar la representatividad de la muestra. Sirven para corregir desviaciones de la muestra debidas a la incidencia de los sesgos de cobertura, selección o no respuesta.

--

- A cada **caso le corresponde un peso** según sus características. El peso será más alto que la media si las características del elemento muestral están subrrepresentadas en la muestra.

--

- Los pesos parten de un **cálculo general**:

`$$\begin{aligned}
w_k = \frac{N_k}{n_k} 
\end{aligned}$$`

--

- Los pesos tienen como misión corregir desviaciones de la muestra, pero también pueden tener un **efecto negativo en la varianza de las estimaciones**, que serán menos precisas.

--

- Algunas encuestas como la ESE **ofrecen pesos** en los datos que hacen públicos para que sean utilizados en los análisis.

---
background-image: url(pics/pic15.png)
background-position: 50% 50% 
background-size: 70% 
# Población

--

.pull-left[
Población de cinco  &lt;/br&gt; **hombres** y cinco **mujeres** &lt;/br&gt; (censo)
]

--

.pull-right[
&lt;/br&gt;
&lt;/br&gt;
&lt;/br&gt;
&lt;/br&gt;
 &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; Investigar su **intención de &lt;/br&gt; &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;voto**
]


---
background-image: url(pics/pic16.png)
background-position: 50% 50% 
background-size: 70% 
# Población

--
.pull-left[
Población (censo): &lt;/br&gt;
&lt;/br&gt;
 5 (50%) **Mujeres** &lt;/br&gt;
 5 (50%) **Hombres**
]

--

.pull-right[
&lt;/br&gt; &lt;/br&gt;&lt;/br&gt; &lt;/br&gt;&lt;/br&gt; &lt;/br&gt;&lt;/br&gt; &lt;/br&gt;&lt;/br&gt; &lt;/br&gt;&lt;/br&gt; &lt;/br&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Población (modo Dios): &lt;/br&gt; &lt;/br&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;5 (50%) **Partido A**&lt;/br&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; 5 (50%) **Partido B**
]

---
background-image: url(pics/pic17.png)
background-position: 50% 50% 
background-size: 70% 
# Incidencia de la no respuesta

--
.pull-left[
Muestra final: &lt;/br&gt;
&lt;/br&gt;
 2 (29%) **Mujeres** &lt;/br&gt;
 5 (71%) **Hombres**
]

--
.pull-right[
&lt;/br&gt; &lt;/br&gt;&lt;/br&gt; &lt;/br&gt;&lt;/br&gt; &lt;/br&gt;&lt;/br&gt; &lt;/br&gt;&lt;/br&gt; &lt;/br&gt;&lt;/br&gt; &lt;/br&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Muestra final: &lt;/br&gt; &lt;/br&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;2 (29%) **Partido A**&lt;/br&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; 5 (71%) **Partido B**
]


---
background-image: url(pics/pic17.png)
background-position: 50% 50% 
background-size: 70% 
# Ponderación

--
.pull-left[
&lt;/br&gt; &lt;/br&gt;
Ponderación como: &lt;/br&gt; &lt;/br&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; `\(w_k = \frac{N_k}{n_k}\)`

Para las **mujeres**: &lt;/br&gt; &lt;/br&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; `\(w_m = \frac{5}{2} = 2.5\)`

Para los **hombres**: &lt;/br&gt; &lt;/br&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; `\(w_h = \frac{5}{5} = 1.0\)`
]

--

.pull-right[
&lt;/br&gt; &lt;/br&gt;&lt;/br&gt; &lt;/br&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; Estimar voto con &lt;/br&gt; &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; **pesos**: 
&lt;/br&gt; &lt;/br&gt;

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;**Mujeres - Partido A**: `\(2*2.5 = 5\)` (50%)  &lt;/br&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;**Mujeres - Partido B**: `\(0*2.5 = 0\)` (0%)  &lt;/br&gt;&lt;/br&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;**Hombres - Partido A**: `\(0*1.0 = 0\)` (0%)   &lt;/br&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;**Hombres - Partido B**: `\(5*1.0 = 5\)` (50%)   &lt;/br&gt;
]

---
# ¿Qué es necesario para que un peso funcione?

- Un peso funciona cuando la **variable auxiliar** que se utiliza para generarlo está **correlacionada con la probabilidad de responder y con la varaible de interés**. En el ejemplo:

  - Sexo (variable auxiliar) estaba relacionado con la probabilidad de responder (H=100%; M=40%).
  
  - Sexo (variable auxiliar) correlacionaba de manera perfecta con el partido a votar (variable de interés).

--

- Las **variables auxiliares**. Estas variables son información que existe para los que participan en la encuesta y para los que no.

  - Puede ser a nivel **individual** (marco muestral) o a nivel **agregado** (totales poblacionales).
  
  - La información auxiliar disponible es **limitada** (INE, otras encuestas), lo que condiciona la capacidad de los ajustes.
  
  - Pensar **teóricamente** qué variables pueden explicar mejor la **probabilidad de responder** y la **variable de interés**.

---
# Tipos de ajustes

Según la función y la manera de generarlos hay diferentes tipos de pesos:

- Pesos de **selección**.

- Pesos de **no respuesta**.

- Pseudopesos a partir de una **encuesta de referencia**.

- Ajuste por modelos **MRP** o **superpoblación**.

- **Postestratificación** y **calibración**.
---
# Pesos de selección

- Se utilizan en encuestas cuando las **probabilidades de selección de los grupos son diferentes** debido al muestreo. También se computan para ajustar las probabilidades de selección dentro de hogares o conglomerados de tamaño desigual.

  - Por ejemplo, cuando en una encuesta a población general en España una comunidad autónoma está sobrerrepresentada.

--

- **Necesario** `\(\rightarrow\)` Este peso se calcula a través de las probabilidades de selección. Es necesario conocer, al menos, el total de casos de cada grupo de la población.

--

&lt;table&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt; Grupo &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; N &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; n &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Prob_sel &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Peso_sel &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Grupo1 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1000 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 500 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.5 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Grupo2 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1000 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 100 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.1 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 10 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Grupo3 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1000 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 100 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.1 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 10 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

---
# Pesos de no respuesta

- Ajustan ante la pérdida de representatividad debido a la **no respuesta o la falta de cobertura**. Dos formas de calcularlos **determinista** o **probabilística**.

--

- En la forma **determinista** o *cell-weighting* se vuelve a realizar en cálculo de `\(\frac{N_k}{n_k}\)`. 

--

- En el método **probabilístico** se realiza un **modelo de regresión logística** en el que la variable dependiente es la respuesta y las variables independientes son las variables auxiliares. A partir del modelo se predice la probabilidad de responder a la encuesta de cada caso. El inverso de esa probabilidad es el peso. 

--

- **Necesario** `\(\rightarrow\)` En el determinista es suficiente con tener los totales poblacionales de cada grupo. En el probabilístico hay que tener **información a nivel individual de los que no responden**.


&lt;table&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt; Grupo &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; N &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; n &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Prob_sel &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Peso_sel &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Resp &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; RespXPeso_sel &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Peso_nr &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Peso_final &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Grupo1 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1000 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 500 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.5 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 250 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 500 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2.00 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 4.0 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Grupo2 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1000 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 100 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.1 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 10 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 90 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 900 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1.11 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 11.1 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Grupo3 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1000 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 100 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.1 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 10 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 70 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 900 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1.43 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 14.3 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

---
# Pseudopesos a partir de una encuesta de referencia

- Esta técnica se usa para **equilibrar muestras no probabilísticas**. Se trata de calcular la *pseudoprobabilidad* de que un elemento de la población se haya unido al panel de internautas y haya respondido a la encuesta.

--

- Para llevarla a cabo se utiliza una **encuesta de referencia** con estándares metodológicos más altos, que comparta algunas variables con la encuesta no probabilística. Estas dos encuestas se unen para **calcular la probabilidad de participar** en la encuesta mediante el uso de una regresión logística. El inverso de esa probabilidad es el peso de ajuste.

--

- **Necesario** `\(\rightarrow\)` Una encuesta de referencia que sea de más calidad y que comparta parte de las variables con la encuesta no probabilística. Las variables compartidas deben explicar el mecanismo de participación.

---
# Ajuste por modelos MRP y superpoblación

- En este caso no se trata de estimar un peso, sino de utilizar **un modelo para ajustar la muestra y predecir el valor de la variable de interés sin sesgo**.

--

- La técnica **MRP** (*multilevel regression and poststratification*) consiste en un modelo multinivel en el que para cada subgrupo se predice la variable dependiente en base a las características disponibles en la muestra y en los datos auxiliares. Las predicciones son ponderadas según las características del subgrupo. Se utiliza sobre todo para realizar estimaciones de voto para subgrupos o regiones con muestras relativamente pequeñas.

- En el **modelo de superpoblación** se predice la variable de interés para cada caso en la población a partir de un modelo ajustado en la muestra no probabilística.

--

- **Necesario** `\(\rightarrow\)` Totales poblacionales a nivel de subgrupo para **MRP**. Datos poblacionales a nivel individual para los **modelos de superpoblación**.

---
# Postestratificación y calibración

- Se trata de **ajustes a través de modelos**. En ambos métodos los *inputs* son los datos de la encuesta y los totales poblacionales. El modelo se encarga de generar unos pesos que fuerzan a la distribución de la muestra a ser idéntica a la de la población.

--

- En la **postestratificación** se incluyen todas las interacciones entre las variables auxiliares. 

- En la **calibración** el ajuste se produce sin tener en cuenta las interacciones entre las variables. Es una técnica más flexible que la postestratificación. 

--

- **Necesario** `\(\rightarrow\)` Los totales poblacionales de las variables por separado en la **calibración** y de los cruces de variables en la **postestratificación**.

---
background-image: url(pics/pic7.png)
background-position: 50% 50% 
background-size: 60% 
# Esquema de la calibración



---
background-image: url(pics/pic8.png)
background-position: 50% 85% 
background-size: 35% 
# La diferencia entre postestratificación y calibración

- Se realiza una **calibración** y **postestratificación** utilizando las variables sexo y edad en grupos.

---
background-image: url(pics/pic9.png)
background-position: 50% 70% 
background-size: 35% 
# La diferencia entre postestratificación y calibración


---
class: inverse, center, middle

# Generar un peso paso a paso con [<i class="fab  fa-r-project "></i>]()

---
# Un ejemplo paso a paso para construir un peso en <i class="fab  fa-r-project "></i>

Para calcular el peso por calibración vamos a utilizar el paquete `survey`. Para la manipulación de datos `tidyverse`.

1. Generar un `vector` con nombres de **totales poblacionales**.

2. Preparar las **variables auxiliares** en la encuesta y el **peso inicial**.

3. Calcular los pesos mediante **calibración**.

4. **Evaluar** la calibración.

5. **Escalar** los pesos para que tengan media 1.

---
# Datos

- Utilizo los datos gss_cat de `tidyverse` para ponderar la muestra utilizando la variable `race` y ajustar la estimación de `partyid`.


```r
gss &lt;- gss_cat %&gt;% 
  filter(year == 2014) %&gt;% 
  select(race, partyid)
  
glimpse(gss)
```

```
## Observations: 2,538
## Variables: 2
## $ race    &lt;fct&gt; White, White, White, White, White, White, White, White, …
## $ partyid &lt;fct&gt; "Not str republican", "Not str republican", "Strong repu…
```

---
# 1. Generar un `vector` de totales poblacionales

- Los totales poblacionales extraídos de la *American Communiy Survey*.

- Crear un `vector` con **nombres de los totales**. En ese vector:
  - El primer elemento del vector siempre lleva el nombre `(Intercept)` y corresponde con el **total poblacional**.
  - De cada variable que se incluya en la calibración se **retira una categoría**.
  - El **nombre de los elementos** es una combinación del nombre de la variable y la etiqueta de la categoría.


```r
totales_pobla &lt;- c("(Intercept)" = 244821329, "raceBlack" = 29330377, "raceWhite" = 196766012)

totales_pobla
```

```
## (Intercept)   raceBlack   raceWhite 
##   244821329    29330377   196766012
```

---
# 2. Preparar las variables auxiliares en la encuesta y el peso inicial

- Revisar que las **categorías de la variable** coninciden con las del vector de totales poblacionales.

- Puede ocurrir que algunas categorías tengan un **número reducido de casos** (n &lt; 10). En esos casos cabe la posibilidad de combinar varias categorías para evitar pesos extremos.


```r
sjmisc::frq(gss$race)
```

```
## 
## x &lt;categorical&gt;
## # total N=2538  valid N=2538  mean=2.64  sd=0.66
## 
##             val  frq raw.prc valid.prc cum.prc
##           Other  262   10.32     10.32   10.32
##           Black  386   15.21     15.21   25.53
##           White 1890   74.47     74.47  100.00
##  Not applicable    0    0.00      0.00  100.00
##            &lt;NA&gt;    0    0.00        NA      NA
```

```r
gss &lt;- mutate(gss, race = recode(race, "Not applicable" = "White"))
```

---
# 2. Preparar las variables auxiliares en la encuesta y el peso inicial

- En la calibración se incluye un peso inicial que es el **peso de selección elevado al total poblacional**. En caso de que no haya peso de selección, se incluye un peso que es el total poblacional entre el número de casos.


```r
gss$peso_ini &lt;- 244821329/nrow(gss)
```

---
# 3. Calcular los pesos mediante calibración

- Declarar el **diseño** de la encuesta con `svydesign()`. Esta función sirve para registrar cuál es el diseño de la encuesta:

  - `ids` sirve para declarar la **variable conglomerados** en el caso de que la meustra sea conglomerada. En caso contrario utilizar `~ 0`.
  - `weights` es el nombre de la variable de los pesos de selección o peso inicial (`~ peso_ini`). 
  
  

```r
gss_svy &lt;- svydesign(ids = ~ 0, weights = ~ peso_ini, data = gss)
```
  
---
# 3. Calcular los pesos mediante calibración

- Generar los **pesos de calibración** con la función `calibrate()`:
      
  - `design` es el objeto de tipo `survey` que se genera en el paso anterior.
  - `formula` son las variables incluidas en la calibración antecedidas por `~`.
  - `population` es el vector de totales poblacionales.
  - `calfun` es el tipo de calibración, se utiliza `logit` para evitar que se den pesos negativos, por eso es obligatorio establecer `bounds` de 0 hasta un valor elevado.


```r
gss_cal &lt;- calibrate(design = gss_svy, 
          formula = ~ race,
          population = totales_pobla,
          calfun = "logit",
          bounds = c(0, 9999999))
```

---
# 4. Evaluar la calibración

- Combinar los **pesos con la encuesta**.

- Comprobar los **máximos y los mínimos** del peso, para evaluar si hay que recortar. 


```r
peso_cal &lt;- weights(gss_cal)
gss$peso_cal &lt;- peso_cal
sjmisc::descr(gss$peso_cal)
```

```
## 
## ## Basic descriptive statistics
## 
##  var    type label    n NA.prc     mean       sd     se     md  trimmed
##   dd numeric    dd 2538      0 96462.31 13109.73 260.22 104109 98622.07
##                       range  skew
##  32639.74 (71469.26-104109) -1.15
```

---
# 4. Evaluar la calibración

- Comprobar que el peso está funcionando comparando la **variable auxiliar** con los **totales poblacionales**.


```r
totales_pobla
```

```
## (Intercept)   raceBlack   raceWhite 
##   244821329    29330377   196766012
```

```r
sjmisc::frq(gss$race, weights = gss$peso_cal)
```

```
## 
## xw &lt;categorical&gt;
## # total N=244821337  valid N=244821337  mean=2.73  sd=0.59
## 
##    val       frq  label raw.prc valid.prc cum.prc
##  Other  18724946 &lt;none&gt;    7.65      7.65    7.65
##  Black  29330379 &lt;none&gt;   11.98     11.98   19.63
##  White 196766012 &lt;none&gt;   80.37     80.37  100.00
##   &lt;NA&gt;         0     NA    0.00        NA      NA
```
---
# 4. Evaluar la calibración

- Evaluar el **efecto sobre una o varias variables relevantes** de la encuesta.


```r
sjmisc::frq(gss$partyid)
```

```
## 
## x &lt;categorical&gt;
## # total N=2538  valid N=2538  mean=7.17  sd=2.10
## 
##                 val frq raw.prc valid.prc cum.prc
##           No answer  25    0.99      0.99    0.99
##          Don't know   1    0.04      0.04    1.02
##         Other party  62    2.44      2.44    3.47
##   Strong republican 245    9.65      9.65   13.12
##  Not str republican 292   11.51     11.51   24.63
##        Ind,near rep 249    9.81      9.81   34.44
##         Independent 502   19.78     19.78   54.22
##        Ind,near dem 337   13.28     13.28   67.49
##    Not str democrat 406   16.00     16.00   83.49
##     Strong democrat 419   16.51     16.51  100.00
##                &lt;NA&gt;   0    0.00        NA      NA
```

---
# 4. Evaluar la calibración


```r
sjmisc::frq(gss$partyid, weights = gss$peso_cal)
```

```
## 
## xw &lt;categorical&gt;
## # total N=244821339  valid N=244821339  mean=7.10  sd=2.10
## 
##                 val      frq  label raw.prc valid.prc cum.prc
##           No answer  2307941 &lt;none&gt;    0.94      0.94    0.94
##          Don't know   104109 &lt;none&gt;    0.04      0.04    0.99
##         Other party  6150942 &lt;none&gt;    2.51      2.51    3.50
##   Strong republican 25081362 &lt;none&gt;   10.24     10.24   13.74
##  Not str republican 29628997 &lt;none&gt;   12.10     12.10   25.84
##        Ind,near rep 25012718 &lt;none&gt;   10.22     10.22   36.06
##         Independent 47993276 &lt;none&gt;   19.60     19.60   55.66
##        Ind,near dem 32266014 &lt;none&gt;   13.18     13.18   68.84
##    Not str democrat 38264856 &lt;none&gt;   15.63     15.63   84.47
##     Strong democrat 38011124 &lt;none&gt;   15.53     15.53  100.00
##                &lt;NA&gt;        0     NA    0.00        NA      NA
```
---
# 5. Escalar el peso

- El último paso consiste en **escalar el peso para que tenga media 1**. En raras ocasiones se mantiene un peso que eleve al total poblacional.


```r
gss$peso_cal &lt;- gss$peso_cal/mean(gss$peso_cal)

sjmisc::descr(gss$peso_cal)
```

```
## 
## ## Basic descriptive statistics
## 
##  var    type label    n NA.prc mean   sd se   md trimmed            range
##   dd numeric    dd 2538      0    1 0.14  0 1.08    1.02 0.34 (0.74-1.08)
##   skew
##  -1.15
```

---
# En resumen

- El **diseño y la recogida** de datos pueden afectar a la **representatividad** de la muestra. Falta de cobertura de la población, no repuesta o selección.

- La **falta de representatividad no invalida el uso de los datos**, pero hay que tenerlo en cuenta a la hora de llvar a cabo el análisis.

- El **análisis de representatividad** permite establecer un diagnóstico de los problemas de la muestra. Cuantos más datos auxiliares, más completo será el análisis de representatividad.

- Los **ajustes** son necesarios para garantizar el proceso de inferencia de la muestra a la población. El uso de pesos es necesario, algunas encuestas incluyen sus propios ajustes.

- El funcionamiento de los ajuste es parcial y dependen de lo **adecuadas que sean las variables auxiliares**. Las variables auxiliares deben explicar el mecanismo de respuesta y estár correlacionadas con las variables de interés.

---
class: inverse, center, middle

# Práctica: ponderar una muestra

---
class: inverse, middle


## Pablo Cabrera Álvarez (USAL)
 &lt;span style = "font-size: 75%;"&gt; pablocal@usal.es | [<i class="fab  fa-github "></i>](https://github.com/pablocal) | [<i class="fab  fa-twitter "></i>](https://twitter.com/pablocalv) @pablocalv &lt;/span&gt; &lt;br&gt; &lt;br&gt; &lt;br&gt;

### Materiales de la sesión en https://github.com/pablocal/course_2019_polling_weights
---
# Bibliografía

- Atkeson, L. R., &amp; Alvarez, R. M. (Eds.). (2018). The Oxford Handbook of Polling and Survey Methods. Oxford University Press.
- Bethlehem, J., &amp; Cobben, F. (2013, August). Web Panels for Official Statistics?. In - Proceedings 59th ISI World Statistics Congress (Vol. 25).
- Bethlehem, J., Cobben, F., &amp; Schouten, B. (2011). Handbook of nonresponse in household surveys (Vol. 568). John Wiley &amp; Sons.
- De Leeuw, E. D., Hox, J., &amp; Dillman, D. (2012). International handbook of survey methodology. Routledge.
- Elliott, M. R., &amp; Valliant, R. (2017). Inference for nonprobability samples. Statistical Science, 32(2), 249-264.
- Groves, R. M., Biemer, P. P., Lyberg, L. E., Massey, J. T., Nicholls, W. L., &amp; Waksberg, J. (Eds.). (2001). Telephone survey methodology (Vol. 328). John Wiley &amp; Sons.
- Lee, S., &amp; Valliant, R. (2009). Estimation for volunteer panel web surveys using propensity score adjustment and calibration adjustment. Sociological Methods &amp; Research, 37(3), 319-343.
- Leslie Kish. (1995). Survey sampling (Vol. 60). Wiley-Interscience.

---
# Bibliografía

- Kohut, A., Keeter, S., Doherty, C., Dimock, M., &amp; Christian, L. (2012). Assessing the representativeness of public opinion surveys. Washington, DC: Pew Research Center.
- Park, D. K., Gelman, A., &amp; Bafumi, J. (2004). Bayesian multilevel estimation with poststratification: State-level estimates from national polls. Political Analysis, 12(4), 375-385.
- Särndal, C. E., &amp; Lundström, S. (2005). Estimation in surveys with nonresponse. John Wiley &amp; Sons.
- Schouten, B., Bethlehem, J., Beullens, K., Kleven, Ø., Loosveldt, G., Luiten, A., . . . &amp; - - Skinner, C. (2012). Evaluating, comparing, monitoring, and improving representativeness of survey response through
- Sturgis, P., Nick, B., Mario, C., Stephen, F., Jane, G., Jennings, W., . . . &amp; Patten, S. (2016). Report of the inquiry into the 2015 British general election opinion polls.
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"ratio": "16:9",
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();</script>

<script>
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
